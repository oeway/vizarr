var qe=Object.defineProperty,Ue=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var se=(e,t,n)=>t in e?qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g=(e,t)=>{for(var n in t||(t={}))Xe.call(t,n)&&se(e,n,t[n]);if(ge)for(var n of ge(t))Ye.call(t,n)&&se(e,n,t[n]);return e},C=(e,t)=>Ue(e,He(t));var we=(e,t,n)=>(se(e,typeof t!="symbol"?t+"":t,n),n);import{X as be,C as Ze,p as xe,a as Je,S as Ke,T as Qe,Q as et,o as re,b as tt,c as nt,Z as ot,H as st,M as ve,d as Q,G as rt,I as at,e as it,f as Y,s as lt,w as ct,g as dt,m as ae,u as M,j as a,h as N,r as j,i as P,F as T,k as ut,l as A,D as ht,O as pt,n as G,V as mt,q as ft,t as q,A as yt,v as I,N as ie,x as Ce,P as le,y as ce,z as D,B as de,E as _e,J as Pe,L as gt,R as Le,K as wt,U as bt,W as xt,Y as vt,_ as ue,$ as Ct,a0 as Se,a1 as _t,a2 as Pt,a3 as Lt,a4 as St}from"./vendor.f6fbb398.js";const It=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};It();const kt="modulepreload",Ie={},zt="./",V=function(t,n){return!n||n.length===0?t():Promise.all(n.map(s=>{if(s=`${zt}${s}`,s in Ie)return;Ie[s]=!0;const o=s.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const i=document.createElement("link");if(i.rel=o?"stylesheet":kt,o||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),o)return new Promise((l,c)=>{i.addEventListener("load",l),i.addEventListener("error",c)})})).then(()=>t())},Et=C(g({},be.defaultProps),{loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});function Rt(e,t,n=[0,0],s=1){const[o,r]=n,i=e*s+o,l=t*s+r;return[o,l,i,r]}function Ot(e){const[t]=e,{width:n,height:s}=t.data;return e.forEach(({data:o})=>{if((o==null?void 0:o.width)!==n||(o==null?void 0:o.height)!==s)throw new Error("Grid data is not same shape.")}),{width:n,height:s}}function ke(e){const{loaders:t,selections:n=[]}=e;let{concurrency:s}=e;return s&&n.length>0&&(s=Math.ceil(s/n.length)),xe(t,async r=>{const i=n.map(c=>r.loader.getRaster({selection:c})),l=await Promise.all(i);return C(g({},r),{data:{data:l.map(c=>c.data),width:l[0].width,height:l[0].height}})},{concurrency:s})}class he extends Ze{initializeState(){this.state={gridData:[],width:0,height:0},ke(this.props).then(t=>{const{width:n,height:s}=Ot(t);this.setState({gridData:t,width:n,height:s})})}updateState({props:t,oldProps:n,changeFlags:s}){const{propsChanged:o}=s,r=typeof o=="string"&&o.includes("props.loaders"),i=t.selections!==n.selections;(r||i)&&ke(this.props).then(l=>{this.setState({gridData:l})})}getPickingInfo({info:t}){if(!t.coordinate)return t;const n=this.props.spacer||0,{width:s,height:o}=this.state,[r,i]=t.coordinate,l=Math.floor(i/(o+n)),c=Math.floor(r/(s+n));return t.gridCoord={row:l,column:c},t}renderLayers(){const{gridData:t,width:n,height:s}=this.state;if(n===0||s===0)return null;const{rows:o,columns:r,spacer:i=0,id:l=""}=this.props,c=t.map(d=>{const u=d.row*(s+i),h=d.col*(n+i),p={channelData:d.data,bounds:Rt(n,s,[h,u]),id:`${l}-GridLayer-${d.row}-${d.col}`,dtype:d.loader.dtype||"Uint16",pickable:!1,extensions:[new Je]};return new be(g(g({},this.props),p))});if(this.props.pickable){const[d,u]=[0,0],h=o*(s+i),p=r*(n+i),m={data:[{polygon:[[u,d],[p,d],[p,h],[u,h]]}],getPolygon:_=>_.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${l}-GridLayer-picking`},x=new Ke(g(g({},this.props),m));c.push(x)}if(this.props.text){const d=new Qe({id:`${l}-GridLayer-text`,data:t,getPosition:u=>[u.col*(n+i),u.row*(s+i)],getText:u=>u.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});c.push(d)}return c}}he.layerName="GridLayer";he.defaultProps=Et;class Mt{constructor(t,n=100){we(this,"cache");this.store=t,this.cache=new et({maxSize:n})}getItem(...t){const[n,s]=t;if(this.cache.has(n))return this.cache.get(n);const o=this.store.getItem(n,s).catch(r=>{throw this.cache.delete(n),r});return this.cache.set(n,o),o}async containsItem(t){return this.cache.has(t)||this.store.containsItem(t)}keys(){return this.store.keys()}deleteItem(t){throw new Error("deleteItem not implemented")}setItem(t,n){throw new Error("setItem not implemented")}}const Z=6,F={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},Dt=[F.magenta,F.green],At=[F.red,F.green,F.blue],ze=Object.values(F).slice(0,-2);async function $t(e){let t;if(typeof e=="string"){let n;if(e.endsWith(".json")){const[{ReferenceStore:s},o]=await Promise.all([V(()=>import("./index.949b4e0f.js"),[]),fetch(e).then(r=>r.json())]);n=s.fromJSON(o)}else{const s=new URL(e);n=new st(s.origin),t=s.pathname.slice(1)}return{store:new Mt(n),path:t}}return{store:e,path:t}}async function jt(e){const{store:t,path:n}=await $t(e);return re(t,n).catch(s=>{if(s instanceof tt)return nt({store:t});throw s})}const Ft=new TextDecoder;function Ee(e,t){return e.store.getItem(U(e.path,t,".zattrs")).then(n=>Ft.decode(n)).then(n=>JSON.parse(n))}async function Re(e,t){const{datasets:n}=t[0]||[{path:"0"}],s=await Promise.all(n.map(({path:o})=>e.getItem(o)));if(s.every(o=>o instanceof ot))return s;throw Error("Multiscales metadata included a path to a group.")}function pe(e){e.startsWith("#")&&(e=e.slice(1));const t=parseInt(e.slice(0,2),16),n=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);return[t,n,s]}function J(e){return Array.from({length:e},(t,n)=>n)}function Nt(e,t=" "){for(;e.length>0&&t.includes(e.charAt(e.length-1));)e=e.substr(0,e.length-1);return e}function U(...e){return e.filter(Boolean).map(t=>Nt(t,"/")).join("/")}function Tt(e,t){return(!t||t.length!=e.shape.length)&&(t=e.shape.slice(0,-2).map((s,o)=>""+o).concat(["y","x"])),t}function ee(e){const t=[{type:"time",name:"t"},{type:"channel",name:"c"},{type:"space",name:"z"},{type:"space",name:"y"},{type:"space",name:"x"}];function n(o){return o==="t"?"time":o==="c"?"channel":"space"}let s=t;return e[0].axes&&(s=e[0].axes.map(o=>{if(typeof o=="string")return{name:o,type:n(o)};const{name:r,type:i}=o;return{name:r,type:i!=null?i:n(r)}})),s}function te(e){return e.map(n=>n.name)}function Oe(e,t){return t||(e<=Z?t=Array(e).fill(!0):t=[...Array(Z).fill(!0),...Array(e-Z).fill(!1)]),t}function Me(e,t){let n=[];if(e==1)n=[F.white];else if(e==2)n=Dt;else if(e===3)n=At;else if(e<=Z)n=ze.slice(0,e);else{n=Array(e).fill(F.white);const s=t.flatMap((o,r)=>o?r:[]);for(const[o,r]of s.entries())n[r]=ze[o]}return n}function De(e){const t=e[e.length-1];return t===3||t===4}function ne(e){const t=De(e.shape),[n,s]=e.chunks.slice(t?-3:-2),o=Math.min(n,s);return 2**Math.floor(Math.log2(o))}function Vt([e,t],[n,s],o,r){const i=(n-r*2)/e,l=(s-r*2)/t;return{zoom:Math.min(o,Math.log2(Math.min(i,l))),target:[e/2,t/2,0]}}function Bt(e){return Array.isArray(e)?e.length===16&&e.every(t=>typeof t=="number"):!1}function K(e){if(!e)return ve.IDENTITY;const t=new ve;try{const n=typeof e=="string"?JSON.parse(e):e;if(!Bt(n))throw Error("Invalid modelMatrix size. Must be 16.");t.setRowMajor(...n)}catch{const n=`Failed to parse modelMatrix. Got ${JSON.stringify(e)}, using identity.`;console.warn(n)}return t}async function me(e,t){if(e.dtype==="Uint8")return[0,255];const{data:n}=await e.getRaster({selection:t});let s=1/0,o=-1/0;for(let r=0;r<n.length;r++)n[r]>o&&(o=n[r]),n[r]<s&&(s=n[r]);return s===o&&(s=0,o=1),[s,o]}async function Ae(e,t,n,s){const o=s!=null?s:e.shape.map(()=>0);if(e.shape[t]!==n.length)throw new Error("provided visibilities don't match number of channels");return Promise.all(n.map(async(i,l)=>{if(!i)return;const c=[...o];return c[t]=l,me(e,c)}))}async function Gt(e,t,n){var L,R,b,E;const s=e.acquisition?parseInt(e.acquisition):void 0;let o=[];if(!(n==null?void 0:n.images))throw Error("Well .zattrs missing images");if(!t.path)throw Error("Cannot inspect zarr path to open well.");const[r,i]=t.path.split("/").filter(Boolean).slice(-2);let{images:l}=n;const c=l.flatMap(v=>v.acquisition?[v.acquisition]:[]);if(c.length>1){const v=t.path.replace(`${r}/${i}`,""),O=await(await re(t.store,v)).attrs.asObject();o=(R=(L=O==null?void 0:O.plate)==null?void 0:L.acquisitions)!=null?R:[],s&&c.includes(s)&&(l=l.filter(W=>W.acquisition===s))}const d=l.map(v=>v.path),u=Math.ceil(Math.sqrt(d.length)),h=Math.ceil(d.length/u),p=await t.getItem(d[0]).then(v=>v.attrs.asObject());if(!("multiscales"in p))throw Error("Path for image is not valid.");let w=p.multiscales[0].datasets[0].path;const m=d.map(v=>t.getItem(U(v,w))),x=await Promise.all(m),_=ee(p.multiscales),k=te(_),z=ne(x[0]),S=J(h).flatMap(v=>J(u).map($=>{const O=$+v*u;return{name:String(O),row:v,col:$,loader:new Q(x[O],k,z)}}));let f;"omero"in p?f=fe(p.omero,_):f=await je(S[0].loader,k);const y=C(g({loaders:S},f),{axis_labels:k,loader:[S[0].loader],model_matrix:K(e.model_matrix),defaults:{selection:f.defaultSelection,colormap:(b=e.colormap)!=null?b:"",opacity:(E=e.opacity)!=null?E:1},name:`Well ${r}${i}`});return o.length>0&&(y.acquisitions=o,y.acquisitionId=s||-1),y.rows=h,y.columns=u,y.onClick=v=>{let $=v.gridCoord;if(!$)return;const{row:O,column:W}=$;let B;if(typeof e.source=="string"&&t.path&&!isNaN(O)&&!isNaN(W)){const X=O*u+W;B=U(e.source,d[X])}e.onClick?(delete v.layer,v.imageSource=B,e.onClick(v)):B&&window.open(window.location.origin+window.location.pathname+"?source="+B)},y}async function $e(e,t,n){var L,R;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const s=n.rows.map(b=>b.name),o=n.columns.map(b=>b.name),r=n.wells.map(b=>b.path),i=await Ee(t,r[0]);if(!("well"in i))throw Error("Path for image is not valid, not a well.");const l=i.well.images[0].path,c=await t.getItem(U(r[0],l)).then(b=>b.attrs.asObject());if(!("multiscales"in c))throw Error("Path for image is not valid.");const{datasets:d}=c.multiscales[0],u=d[d.length-1].path;async function h(b){const E=await Ee(t,b);return U(b,E.well.images[0].path)}const p=await Promise.all(r.map(h)),w=([b,E])=>t.getItem(E).then(v=>[b,v]),m=await xe(p.map(b=>[b,U(b,u)]),w,{concurrency:10}),x=await Promise.all(m),_=ee(c.multiscales),k=te(_),z=ne(x[0][1]),S=x.map(b=>{const[E,v]=b[0].split("/");return{name:`${E}${v}`,row:s.indexOf(E),col:o.indexOf(v),loader:new Q(b[1],k,z)}});let f;"omero"in c?f=fe(c.omero,_):f=await je(S[0].loader,k);const y=C(g({loaders:S},f),{axis_labels:k,loader:[S[0].loader],model_matrix:K(e.model_matrix),defaults:{selection:f.defaultSelection,colormap:(L=e.colormap)!=null?L:"",opacity:(R=e.opacity)!=null?R:1},name:n.name||"Plate",rows:s.length,columns:o.length});return y.onClick=b=>{let E=b.gridCoord;if(!E)return;const{row:v,column:$}=E;let O;typeof e.source=="string"&&t.path&&!isNaN(v)&&!isNaN($)&&(O=U(e.source,s[v],o[$])),e.onClick?(delete b.layer,b.imageSource=O,e.onClick(b)):O&&window.open(window.location.origin+window.location.pathname+"?source="+O)},y}async function Wt(e,t,n){var p;const{name:s,opacity:o=1,colormap:r=""}=e,i=await Re(t,n.multiscales),l=ee(n.multiscales),c=te(l),d=fe(n.omero,l),u=ne(i[0]),h=i.map(w=>new Q(w,c,u));return C(g({loader:h,axis_labels:c,model_matrix:K(e.model_matrix),defaults:{selection:d.defaultSelection,colormap:r,opacity:o}},d),{name:(p=d.name)!=null?p:s})}async function je(e,t){const n=t.indexOf("c"),s=e.shape[n],o=Oe(s),r=await Ae(e,n,o),i=Me(s,o);return{name:"Image",names:J(s).map(l=>`channel_${l}`),colors:i,contrast_limits:r,visibilities:o,channel_axis:t.includes("c")?t.indexOf("c"):null,defaultSelection:t.map(()=>0)}}function fe({rdefs:e,channels:t,name:n},s){var p,w;const o=(p=e.defaultT)!=null?p:0,r=(w=e.defaultZ)!=null?w:0,i=[],l=[],c=[],d=[];t.forEach((m,x)=>{i.push(m.color),l.push([m.window.start,m.window.end]),c.push(m.active),d.push(m.label||""+x)});const u=s.map(m=>m.type=="time"?o:m.name=="z"?r:0),h=s.findIndex(m=>m.type==="channel");return{name:n,names:d,colors:i,contrast_limits:l,visibilities:c,channel_axis:h,defaultSelection:u}}async function qt(e,t){const{color:n,contrast_limits:s,visibility:o,name:r,colormap:i="",opacity:l=1}=e,c=t[t.length-1],d=Array(t[0].shape.length).fill(0),u=s!=null?s:await(()=>me(c,d))();return{loader:t,name:r,channel_axis:null,colors:[n!=null?n:F.white],names:["channel_0"],contrast_limits:[u],visibilities:[o!=null?o:!0],model_matrix:K(e.model_matrix),defaults:{selection:d,colormap:i,opacity:l},axis_labels:t[0].labels}}async function Ut(e,t,n){const{names:s,contrast_limits:o,name:r,model_matrix:i,opacity:l=1,colormap:c=""}=e;let{visibilities:d,colors:u}=e;const h=t[0].shape[n];for(const w of[o,d,s,u])if(w&&w.length!==h){const m=Object.keys({channelProp:w})[0];throw Error(`channel_axis is length ${h} and provided channel_axis property ${m} is different size.`)}d=d||Oe(h),u=u||Me(h,d);const p=o!=null?o:await(()=>Ae(t[t.length-1],n,d))();return{loader:t,name:r,channel_axis:n,colors:u,names:s!=null?s:J(h).map(w=>`channel_${w}`),contrast_limits:p,visibilities:d,model_matrix:K(i),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:c,opacity:l},axis_labels:t[0].labels}}async function Ht(e){var u;const t=await jt(e.source);let n,s;if(t instanceof rt){const h=await t.attrs.asObject();if("plate"in h)return $e(e,t,h.plate);if("well"in h)return Gt(e,t,h.well);if("omero"in h)return Wt(e,t,h);if(Object.keys(h).length===0&&t.path){const p=t.path.slice(0,t.path.lastIndexOf("/")),w=await re(t.store,p),m=await w.attrs.asObject();if("plate"in m)return $e(e,w,m.plate)}if(!("multiscales"in h))throw Error("Group is missing multiscales specification.");n=await Re(t,h.multiscales),h.multiscales[0].axes&&(s=ee(h.multiscales))}else n=[t];const{channel_axis:o,labels:r}=Xt(e,s,n[0]),i=ne(n[0]),l=n.map(h=>new Q(h,r,i)),[c]=l;if("channel_axis"in e||o>-1)return e=e,Ut(e,l,Number((u=e.channel_axis)!=null?u:o));if(c.shape.length===2||!("channel_axis"in e))return qt(e,l);throw Error("Failed to load image.")}function Xt(e,t,n){const s=e.axis_labels,o="channel_axis"in e?Number(e.channel_axis):void 0;if(t){const l=s!=null?s:te(t),c=o!=null?o:t.findIndex(d=>d.type==="channel");return{labels:l,channel_axis:c}}const r=s!=null?s:Tt(n),i=o!=null?o:r.indexOf("c");return{labels:r,channel_axis:i}}function Fe(e){var u;const{selection:t,opacity:n,colormap:s}=e.defaults,o=[],r=[],i=[],l=[],c=e.visibilities.flatMap((h,p)=>h?p:[]);for(const h of c){const p=[...t];Number.isInteger(e.channel_axis)&&(p[e.channel_axis]=h),o.push(p),r.push(pe(e.colors[h])),i.push((u=e.contrast_limits[h])!=null?u:[0,255]),l.push(!0)}const d={id:e.id,selections:o,colors:r,contrastLimits:i,contrastLimitsRange:[...i],channelsVisible:l,opacity:n,colormap:s,modelMatrix:e.model_matrix,onClick:e.onClick};return"loaders"in e?{Layer:he,layerProps:C(g({},d),{loader:e.loader,loaders:e.loaders,columns:e.columns,rows:e.rows}),on:!0}:e.loader.length===1?{Layer:at,layerProps:C(g({},d),{loader:e.loader[0]}),on:!0}:{Layer:it,layerProps:C(g({},d),{loader:e.loader}),on:!0}}var Yt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createSourceData:Ht,initLayerStateFromSource:Fe});const Zt={zoom:0,target:[0,0,0],default:!0},ye=Y([]),Ne=Y(Zt),Te=lt(ye),Ve=dt(e=>Y(C(g({},Fe(e)),{id:e.id})),(e,t)=>e.id===t.id),Jt=Y(e=>{const t=e(Te);if(t.length===0)return[];const n=t.map(s=>Ve(e(s)));return e(ct(n))}),Be=Y(!1);var Kt="./logo-wide.71b84d45.png";const Qt=ae({loadingIcon:{position:"absolute",left:"calc(50vw - 20px)",top:"calc(50vh - 20px)",color:"white"},loadingText:{position:"absolute",left:"50vw",top:"calc(50vh + 45px)",color:"white",transform:"translate(-50%, -50%)"},floatingLogo:{position:"absolute",left:"50vw",top:"50vh",color:"white",width:"200px",maxWidth:"100%",transform:"translate(-50%, -50%)"}});function en(e){const{loader:t}=e,[n,s]=Array.isArray(t)?[t[0],t.length]:[t,0],o=De(n.shape);let[r,i]=n.shape.slice(o?-3:-2);if("loaders"in e&&e.rows&&e.columns){const l=5;r=(r+l)*e.rows,i=(i+l)*e.columns}return{height:r,width:i,maxZoom:s}}function tn({layers:e}){var l,c;const[t,n]=N(Ne),s=M(Be),o=j.exports.useRef(null),r=Qt(),i=M(ye);if(o.current&&(t==null?void 0:t.default)&&((c=(l=e[0])==null?void 0:l.props)==null?void 0:c.loader)){const{deck:d}=o.current,{width:u,height:h,maxZoom:p}=en(e[0].props),w=d.width<400?10:d.width<600?30:50,{zoom:m,target:x}=Vt([u,h],[d.width,d.height],p,w);n({zoom:m,target:x})}return P(T,{children:[a("img",{className:r.floatingLogo,style:{visibility:Object.keys(i).length>0||s?"hidden":"visible"},src:Kt,alt:"logo"}),a(ut,{className:r.loadingIcon,style:{visibility:s?"visible":"hidden"}}),typeof s=="string"?a(A,{className:r.loadingText,variant:"h6",children:s}):"",a(ht,{ref:o,layers:e,viewState:t,onViewStateChange:d=>n(d.viewState),views:[new pt({id:"ortho",controller:!0})]})]})}function nn(){const t=M(Jt).map(n=>n.on?new n.Layer(n.layerProps):null);return a(tn,{layers:t})}function on({sourceAtom:e,layerAtom:t}){const n=M(e),[s,o]=N(t),r=i=>{i.stopPropagation(),o(l=>{const c=!l.on;return C(g({},l),{on:c})})};return a(G,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:r,style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${s.on?1:.5})`},children:s.on?a(mt,{}):a(ft,{})})}const sn=q({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(yt);function rn({sourceAtom:e,layerAtom:t,name:n}){const o=`layer-controller-${M(e).id}`;return a(sn,{"aria-controls":o,id:o,children:P("div",{style:{display:"flex",flexDirection:"row"},children:[a(on,{sourceAtom:e,layerAtom:t}),a(A,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2",children:n})]})})}function an({sourceAtom:e}){const t=M(e),{acquisitionId:n,acquisitions:s}=t;return s?a(T,{children:a(I,{children:P(ie,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:r=>{let i=r.target.value;const l=new URL(window.location.href);i==="-1"?l.searchParams.delete("acquisition"):l.searchParams.set("acquisition",i),window.location.href=decodeURIComponent(l.href)},value:n,children:[a("option",{value:"-1",children:"Filter by Acquisition"},"-1"),s.map(r=>(r=r,P("option",{value:r.id,children:["Acquisition: ",r.name]},r.id)))]})})}):null}function ln({sourceAtom:e,layerAtom:t}){const[n,s]=N(e),[o,r]=N(t),[i,l]=j.exports.useState(null),c=m=>{l(m.currentTarget)},d=()=>{l(null)},u=async m=>{d();const x=+m.target.value,_=[...n.defaults.selection];n.channel_axis&&(_[n.channel_axis]=x);let k;if(n.contrast_limits[x])k=n.contrast_limits[x];else{const{loader:z}=o.layerProps,S=Array.isArray(z)?z[z.length-1]:z;k=await me(S,_),s(f=>{const y=[...f.contrast_limits];return y[x]=k,C(g({},f),{contrast_limits:y})})}r(z=>{const{layerProps:S}=z,f=[...S.selections,_],y=[...S.colors,pe(n.colors[x])],L=[...S.contrastLimitsRange,k],R=[...S.channelsVisible,!0];return C(g({},z),{layerProps:C(g({},S),{selections:f,colors:y,contrastLimits:L,contrastLimitsRange:[...L],channelsVisible:R})})})},{names:h}=n,p=Boolean(i),w=p?`layer-${n.id}-add-channel`:void 0;return P(T,{children:[a(G,{onClick:c,"aria-describedby":w,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:o.layerProps.selections.length===Z,children:a(Ce,{})}),a(le,{id:w,open:p,anchorEl:i,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:P(ce,{style:{padding:"0px 4px",marginBottom:4,width:"8em"},children:[a(A,{variant:"caption",children:"selection: "}),a(D,{}),P(ie,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:u,children:[a("option",{"aria-label":"None",value:"",children:"None"}),h.map((m,x)=>a("option",{value:x,children:m},m))]})]})})]})}const cn=q({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(de);function dn({layerAtom:e}){const[t,n]=N(e),s=(o,r)=>{const i=r;n(l=>C(g({},l),{layerProps:C(g({},l.layerProps),{opacity:i})}))};return a(cn,{value:t.layerProps.opacity,onChange:s,min:0,max:1,step:.01})}const un=q({root:{width:"5.5em",fontSize:"0.7em"}})(_e);function hn({sourceAtom:e,layerAtom:t,axisIndex:n,max:s}){const o=M(e),[r,i]=N(t),[l,c]=j.exports.useState(null),d=x=>{c(x.currentTarget)},u=()=>{c(null)},h=x=>{let _=+x.target.value;_<0&&(_=0),_>s&&(_=s),i(k=>{let z=g({},k.layerProps);return z.selections=z.selections.map(S=>{let f=[...S];return f[n]=_,f}),C(g({},k),{layerProps:z})})},p=Boolean(l),w=p?`${n}-index-${o.id}-options`:void 0,m=r.layerProps.selections[0]?r.layerProps.selections[0][n]:1;return P(T,{children:[a(G,{onClick:d,"aria-describedby":w,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:a(Pe,{})}),a(le,{id:w,open:p,anchorEl:l,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:P(ce,{style:{padding:"0px 4px",marginBottom:4},children:[a(A,{variant:"caption",children:"Index:"}),a(D,{}),a(un,{value:m,onChange:h,type:"number",id:"max",fullWidth:!1}),a(D,{})]})})]})}const pn=q({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(de);function mn({sourceAtom:e,layerAtom:t,axisIndex:n,max:s}){const[o,r]=N(t),i=M(e),{axis_labels:l}=i;let c=l[n];(c==="t"||c==="z")&&(c=c.toUpperCase());const[d,u]=j.exports.useState(0),[h,p]=j.exports.useState(0);return j.exports.useEffect(()=>{u(o.layerProps.selections[0]?o.layerProps.selections[0][n]:1),p(Array.isArray(c)?c[d]:c)},[o.layerProps.selections]),P(T,{children:[P(I,{children:[P(I,{container:!0,justifyContent:"space-between",children:[a(I,{item:!0,xs:10,children:a("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:P(A,{variant:"caption",children:[h,": ",d,"/",s]})})}),a(I,{item:!0,xs:1,children:a(hn,{sourceAtom:e,layerAtom:t,axisIndex:n,max:s})})]}),a(I,{container:!0,justifyContent:"space-between",children:a(I,{item:!0,xs:12,children:a(pn,{value:d,onChange:(x,_)=>{u(_),p(Array.isArray(c)?c[_]:c)},onChangeCommitted:()=>{r(x=>{let _=g({},x.layerProps);return _.selections=_.selections.map(k=>{let z=[...k];return z[n]=d,z}),C(g({},x),{layerProps:_})})},min:0,max:s,step:1})})})]}),a(D,{})]})}function fn({sourceAtom:e,layerAtom:t}){const n=M(e),{axis_labels:s,channel_axis:o,loader:r}=n,i=s.slice(0,-2).map((l,c)=>[l,c,r[0].shape[c]]).filter(l=>l[1]===o?!1:l[2]>1).map(([l,c,d])=>a(mn,{sourceAtom:e,layerAtom:t,axisIndex:c,max:d-1},l));return i.length===0?null:P(T,{children:[a(I,{children:i}),a(D,{})]})}const yn=ae(()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}})),gn=Object.entries(F).map(([e,t])=>[e,pe(t)]);function wn({handleChange:e}){const t=yn();return a("div",{className:t.container,"aria-label":"color-swatch",children:gn.map(([n,s])=>a(G,{className:t.button,onClick:()=>e(s),children:a(gt,{fontSize:"small",style:{color:`rgb(${s})`}})},n))})}const Ge=q({root:{width:"5.5em",fontSize:"0.7em"}})(_e);function bn({sourceAtom:e,layerAtom:t,channelIndex:n}){const s=M(e),[o,r]=N(t),[i,l]=j.exports.useState(null),{channel_axis:c,names:d}=s,u=f=>{l(f.currentTarget)},h=()=>{l(null)},p=f=>{r(y=>{const L=[...y.layerProps.colors];return L[n]=f,C(g({},y),{layerProps:C(g({},y.layerProps),{colors:L})})})},w=f=>{const y=f.target.id;let L=+f.target.value;L<0&&(L=0),r(R=>{const b=[...R.layerProps.contrastLimitsRange],E=[...R.layerProps.contrastLimits],[v,$]=b[n],[O,W]=E[n],[B,X]=y==="min"?[L,$]:[v,L];return B>O&&(E[n]=[B,W]),X<W&&(E[n]=[O,X]),E[n]=[B,X],C(g({},R),{layerProps:C(g({},R.layerProps),{contrastLimits:E,contrastLimitsRange:b})})})},m=()=>{r(f=>{const{layerProps:y}=f,L=[...y.colors],R=[...y.contrastLimits],b=[...y.contrastLimitsRange],E=[...y.selections],v=[...y.channelsVisible];return L.splice(n,1),R.splice(n,1),b.splice(n,1),E.splice(n,1),v.splice(n,1),C(g({},f),{layerProps:C(g({},y),{colors:L,selections:E,channelsVisible:v,contrastLimits:R,contrastLimitsRange:b})})})},x=f=>{r(y=>{const L=[...y.layerProps.selections],R=[...L[n]];return Number.isInteger(c)&&(R[c]=+f.target.value,L[n]=R),C(g({},y),{layerProps:C(g({},y.layerProps),{selections:L})})})},_=Boolean(i),k=_?`channel-${n}-${s.name}-options`:void 0,[z,S]=o.layerProps.contrastLimitsRange[n];return P(T,{children:[a(G,{onClick:u,"aria-describedby":k,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},children:a(Pe,{})}),a(le,{id:k,open:_,anchorEl:i,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:P(ce,{style:{padding:"0px 4px",marginBottom:4},children:[P("div",{style:{display:"flex",justifyContent:"space-between"},children:[a(A,{variant:"caption",children:"remove:"}),a(G,{onClick:m,children:a(Le,{})})]}),a(D,{}),a(A,{variant:"caption",children:"selection:"}),a(D,{}),a(ie,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${s.name}-channel-select`,onChange:x,value:o.layerProps.selections[n][c],children:d.map((f,y)=>P("option",{value:y,children:["(",y,") ",f]},f))}),a(D,{}),a(A,{variant:"caption",children:"contrast limits:"}),a(D,{}),a(Ge,{value:z,onChange:w,type:"number",id:"min",fullWidth:!1}),a(Ge,{value:S,onChange:w,type:"number",id:"max",fullWidth:!1}),a(D,{}),a(A,{variant:"caption",children:"color:"}),a(D,{}),a("div",{style:{display:"flex",justifyContent:"center"},children:a(wn,{handleChange:p})})]})})]})}function xn({sourceAtom:e,layerAtom:t,channelIndex:n}){const s=M(e),[o,r]=N(t),i=(S,f)=>{r(y=>{const L=[...y.layerProps.contrastLimits];return L[n]=f,C(g({},y),{layerProps:C(g({},y.layerProps),{contrastLimits:L})})})},l=()=>{r(S=>{const f=[...S.layerProps.channelsVisible];return f[n]=!f[n],C(g({},S),{layerProps:C(g({},S.layerProps),{channelsVisible:f})})})},c=o.layerProps,d=[...c.contrastLimits[n]],u=`rgb(${c.colormap?[255,255,255]:c.colors[n]})`,h=c.channelsVisible[n],[p,w]=c.contrastLimitsRange[n],{channel_axis:m,names:x}=s,_=c.selections[n],k=Number.isInteger(m)?_[m]:0,z=x[k];return P(T,{children:[P(I,{container:!0,justifyContent:"space-between",wrap:"nowrap",children:[a(I,{item:!0,xs:10,children:a("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"},children:a(A,{variant:"caption",noWrap:!0,children:z})})}),a(I,{item:!0,xs:1,children:a(bn,{sourceAtom:e,layerAtom:t,channelIndex:n})})]}),P(I,{container:!0,justifyContent:"space-between",children:[a(I,{item:!0,xs:2,children:a(G,{style:{color:u,backgroundColor:"transparent",padding:0,zIndex:2},onClick:l,children:h?a(wt,{}):a(bt,{})})}),a(I,{item:!0,xs:10,children:a(de,{value:d,onChange:i,min:p,max:w,step:.01,style:{padding:"10px 0px 5px 0px",color:u}})})]})]})}const vn=q({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(xt);function Cn({sourceAtom:e,layerAtom:t}){const s=M(t).layerProps.selections.length;return a(vn,{children:P(I,{container:!0,direction:"column",children:[a(an,{sourceAtom:e,layerAtom:t}),a(I,{children:P(I,{container:!0,justifyContent:"space-between",children:[a(I,{item:!0,xs:3,children:a(A,{variant:"caption",children:"opacity:"})}),a(I,{item:!0,xs:8,children:a(dn,{sourceAtom:e,layerAtom:t})})]})}),a(D,{}),a(fn,{sourceAtom:e,layerAtom:t}),P(I,{container:!0,justifyContent:"space-between",children:[a(I,{item:!0,xs:3,children:a(A,{variant:"caption",children:"channels:"})}),a(I,{item:!0,xs:1,children:a(ln,{sourceAtom:e,layerAtom:t})})]}),a(D,{}),a(I,{children:J(s).map(o=>a(xn,{sourceAtom:e,layerAtom:t,channelIndex:o},o))})]})})}const _n=q({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(vt);function Pn({sourceAtom:e}){const t=M(e),n=Ve(t),{name:s=""}=t;return P(_n,{defaultExpanded:!0,children:[a(rn,{sourceAtom:e,layerAtom:n,name:s}),a(Cn,{sourceAtom:e,layerAtom:n})]})}const Ln=ae({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function Sn(){const e=M(Te),[t,n]=j.exports.useReducer(o=>!o,!1),s=Ln();return a("div",{className:s.root,style:{padding:`0px 5px ${t?0:5}px 5px`},children:P(I,{container:!0,direction:"column",alignItems:"flex-start",children:[a(G,{style:{backgroundColor:"transparent",padding:0,visibility:e.length>0?"visible":"hidden"},onClick:n,children:t?a(Ce,{}):a(Le,{})}),a("div",{className:s.scroll,style:{display:t?"none":"flex"},children:e.map(o=>a(Pn,{sourceAtom:o},`${o}`))})]})})}const We="0.3.0";function In(){const e=ue(ye),t=ue(Ne),n=ue(Be);async function s(o){try{n(!0);const{createSourceData:r}=await V(()=>Promise.resolve().then(function(){return Yt}),void 0),i=Math.random().toString(36).slice(2),l=await r(o);e(c=>(l.name||(l.name=`image_${Object.keys(c).length}`),[...c,g({id:i},l)]))}catch(r){throw r}finally{n(!1)}}return j.exports.useEffect(()=>{const o=new URLSearchParams(window.location.search);if(o.has("source")){const r={};for(const[c,d]of o)r[c]=d;r.source=decodeURIComponent(r.source),s(r);const i=new URL(window.location.href);i.searchParams.set("source",r.source);const l=decodeURIComponent(i.toString());window.location.href!==l&&window.history.pushState(null,"",l)}},[]),j.exports.useEffect(()=>{async function o(){const{imjoyRPC:r}=await V(()=>import("./index.326d27d5.js").then(function(u){return u.i}),[]),i=await r.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:We}),l=async u=>s(u),c=async u=>t(u),d=async u=>n(u);i.export({add_image:l,set_view_state:c,show_loading:d})}window.self!==window.top&&o()},[]),P(T,{children:[a(Sn,{}),a(nn,{})]})}var kn=Ct({palette:{type:"dark",primary:Se,secondary:Se},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}});const oe=new Map;function H(e,t){_t(e,()=>{if(!oe.has(e)){const s=t().then(o=>o.default).catch(o=>{throw oe.delete(e),o});oe.set(e,s)}return oe.get(e)})}H("lz4",()=>V(()=>import("./lz4.87389b44.js"),[]));H("gzip",()=>V(()=>import("./gzip.87321722.js"),["gzip.87321722.js","pako.esm-856454b6.df899be9.js"]));H("zlib",()=>V(()=>import("./zlib.c77211ff.js"),["zlib.c77211ff.js","pako.esm-856454b6.df899be9.js"]));H("zstd",()=>V(()=>import("./zstd.d76669c6.js"),[]));H("blosc",()=>V(()=>import("./blosc.4ec40f1c.js"),[]));H("jpeg2k",()=>V(()=>import("./jpeg2k.effd323e.js"),[]));console.log(`vizarr v${We}: https://github.com/hms-dbmi/vizarr`);Pt.render(a(Lt,{theme:kn,children:a(St,{children:a(In,{})})}),document.getElementById("root"));
